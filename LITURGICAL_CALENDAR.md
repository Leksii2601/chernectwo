# Літургійний календар - Документація

## Особливості алгоритму

### 1. Передсвято Богоявлення (2-5 січня)

**Проблема**: Період 2-5 січня має спеціальні читання передсвята, які повністю замінюють рядові читання тижня.

**Рішення**: 
- Додано до `fixed_readings.json` записи для кожного дня передсвята
- Всі дні містять **комбіновані читання**: передсвята + святого дня
- Використовується **Євангелія від Марка** (маркова переступка)
- Читання містять позначки "(за чт)", "(за пт)", "(за сб)" - перенесення через свята

**Приклад для 2 січня 2026 (п'ятниця):**
```
Передсв.: 
  Ап. Євр. 326 зач.; 10:35 – 11:7 (за чт)
  Ап. Євр. 327 зач.; 11:8, 11-16 (за пт)
  Єв. Мк. 39 зач.; 9:10-16 (за чт)
  Єв. Мк. 41 зач.; 9:33-41 (за пт)

Свт. Сильвестру:
  Ап. Євр. 318 зач.; 7:26 – 8:2
  Єв. Ін. 8 зач.; 3:1-15
```

---

### 2. Субота перед Митарем і фарисеєм (31 січня 2026)

**Проблема**: Ця субота не є частиною тижня 34, а є спеціальною суботою перед початком Тріоді.

**Рішення**: 
- Виявлення: `-71 день` від Пасхи + `dayName === 'saturday'`
- Дані: `tableB.json` → `triodion_preparation.saturday_before_publican`
- Читання: **2 Тим 2:11-19; Лк 18:2-8** (рядові)
- Плюс: читання для Безсрібників Кира та Іоана з `fixed_readings.json`

**Комбіновані читання для 31 січня 2026:**
```
Безсрібн.: Ап. 1 Кор. 153 зач. (12:27 – 13:8); Єв. Мф. 34 зач. (10:1, 5-8)
Ряд.: Ап. 2 Тим. 293 зач. (2:11-19); Єв. Лк. 88 зач. (18:2-8)
```

---

### 3. Четвер з переніссям читань (29 січня 2026)

**Структура**: Три типи читань на один день

#### а) Рядові читання четверга 34-го тижня
- **Апостол**: 1 Пет. 62 зач.; 3:10-22
- **Євангелія**: Мк. 57 зач.; 12:13-17

#### б) Перенесені читання п'ятниці 
Оскільки 30 січня - велике свято Трьох Святителів:
- **Апостол**: 2 Пет. 64 зач.; 1:1-10
- **Євангелія**: Мк. 58 зач.; 12:18-27

#### в) Читання святому Ігнатію Богоносцю
- **Апостол**: Євр. 311 зач.; 4:14 – 5:6
- **Євангелія**: Мк. 41 зач.; 9:33-41

**Результат**:
```
Ап.: 1 Пет 3:10-22; 2 Пет 1:1-10; Євр. 311 зач.; 4:14 – 5:6
Єв.: Мк 12:13-17; Мк 12:18-27; Мк. 41 зач.; 9:33-41
```

---

### 4. Технічна реалізація

#### Файл: `fixed_readings.json`
Додано всі дні передсвята Богоявлення:
```json
{
  "date_month_day": "01-02",
  "title": "Передсвято Богоявлення. Свт. Сильвестра, папи Римського",  
  "apostle": "Передсв.: Євр. 326 зач.; ... Свт.: Євр. 318 зач.; ...",
  "gospel": "Передсв.: Мк. 39 зач.; ... Свт.: Ін. 8 зач.; ..."
}
```

#### Файл: `tableB.json`
Додано суботу перед Тріоддю:
```json
"saturday_before_publican": {
  "name": "Субота перед Митарем і фарисеєм",
  "saturday": { "ap": "293", "ev": "88", "ref": "2 Тим 2:11-19; Лк 18:2-8" }
}
```

#### Файл: `calendarGenerator_test.ts`

**Функція `getLiturgicalPosition()`:**
```typescript
// Special case: Saturday before Publican and Pharisee (-71 days from Easter)
if (diffDays === -71 && dayName === 'saturday') {
    return { cycle: 'TRIODION', weekIndex: 0, dayName, key: 'saturday_before_publican' };
}
```

**Функція `getReadingForDay()`:**
Комбінує читання з трьох джерел:
1. Рядові (Pentecost cycle або Triodion)
2. Перенесені (якщо наступний день - велике свято)
3. Святому дня (з `fixed_readings.json`)

---

### 5. Пріоритетність читань

Для **2-5 січня** (передсвято):
1. **Fixed readings** має найвищий пріоритет - повністю замінює рядові
2. Алгоритм відображає саме ці передсвятні читання

Для **інших днів**:
1. **Субота перед Тріоддю** (`-71 день від Пасхи`)
2. **Фіксовані свята** (`fixed_readings.json`)
3. **Рухомі свята** (`tableB.json` - Тріодь, Піст)
4. **Перенесені читання** (якщо наступний день - велике свято)
5. **Рядові читання** (`tableA.json` - тижні після П'ятдесятниці)

---

### 6. Особливості періоду 2-5 січня

- **Маркова переступка**: Замість Луки читається Євангелія від Марка
- **Перенесення**: Читання мають позначки "(за чт)", "(за пт)", "(за сб)"
- **Комбінація**: Кожен день містить і передсвятні, і святим читання
- **Пріоритет**: Повністю витісняють рядові читання 30-32 тижнів

---

## Архітектура та Стратегія Розвитку (Для розробників та AI)

### Чому Січень — це "Пекло" для розробника?
Проблема полягає у варіативній кількості днів між нерухомим святом **Богоявлення (6 січня)** та початком **Тріоді** (залежить від Великодня). Церковний Устав заповнює цю "пустоту" шляхом **відступок** (літургійних стрибків), коли читання "висмикуються" з майбутніх тижнів.
Лінійні алгоритми тут безсилі, оскільки Типікон діє адаптивно.

### Гібридний Підхід до Реалізації
Ми використовуємо комбінацію **Алгоритму** та **Ручних Пачів (Hardcode)**:

1.  **Літо та Осінь (Червень-Вересень)**: "Золотий час". Використовується суто алгоритмічний підхід (`getPentecostWeek`), оскільки читання йдуть послідовно.
2.  **Тріодь (Лютий-Квітень)**: Стабільний період. Всі дати жорстко прив'язані до пасхалії, тому `getLiturgicalPosition` працює ідеально.
3.  **Перехідні періоди (Січень та Жовтень)**: 
    - Використовується "Хардкод" (`YEAR_SPECIFIC_READINGS`) як **офіційна стратегія**.
    - Спроба запрограмувати "Лукіну переступку" або "Хрещенську відступку" чисто алгоритмічно — це шлях до помилок, бо умов занадто багато.

### Порада на майбутнє
Для повної автономності системи в майбутньому можна реалізувати логіку **"Літургійного залишку"**:
- Обчислювати кількість тижнів від поточного дня до *Неділі про Митаря і Фарисея*.
- Якщо тижнів менше, ніж є в календарі читань — автоматично робити стрибок до зачал 32-го тижня.

Але на даному етапі, ручне заповнення `YEAR_SPECIFIC_READINGS` для проблемних 2-3 тижнів на рік є найбільш надійним та безпечним рішенням.

**Статус**: ✅ Відповідає офіційному календарю ПЦУ
**Дата останнього оновлення стратегії**: 30 січня 2026
