# Структуровані читання - Документація

## Огляд

Літургійний календар тепер підтримує **структуровані читання** у форматі, який відповідає офіційному додатку ПЦУ.

## Нова структура даних

### Інтерфейси

```typescript
// Окреме читання
export interface Reading {
    label?: string; // "Ряд.", "Сщмч.", "за п'ятницю", тощо
    apostle: string;
    gospel: string;
}

// Всі читання дня
export interface DayReadings {
    morning?: string; // Ранкові читання (опціонально)
    liturgy: Reading[]; // Масив читань на Літургії
}

export interface CalendarDay {
    // ...інші поля...
    readings: string; // Старий формат (для зворотної сумісності)
    readingsStructured?: DayReadings; // Новий структурований формат
}
```

## Приклад даних

### 29 січня 2026 (четвер)

```json
{
  "date": "2026-01-29",
  "readingsStructured": {
    "liturgy": [
      {
        "label": "Ряд.",
        "apostle": "1 Пет 3:10-22",
        "gospel": "Мк 12:13-17"
      },
      {
        "label": "за п'ят" }
      }
    ]
  }
}
```

## Функції

### 1. `getStructuredReadings(date, easter, lang): DayReadings`

Головна функція з генерації структурованих читань.

**Логіка роботи:**
1. **Рядові читання** - з tableA або tableB, мітка "Ряд."
2. **Перенесені читання** - якщо наступний день велике свято, мітка "за п'ятницю"
3. **Читання святому** - з fixed_readings.json, автоматична мітка (Сщмч., Свт., тощо)

### 2. `getSaintLabel(title): string | undefined`

Витягує скорочену мітку зі назви святого:
- "Сщмч. Ігнатія" → "Сщмч."
- "Свт. Миколая" → "Свт."
- "Прп. Антонія" → "Прп."

### 3. `formatReadingsForDisplay(readings): string`

Форматує структуровані читання для відображення:

```typescript
const formatted = formatReadingsForDisplay(readings);
// Результат:
// "Літ. – Ряд.: Ап. 1 Пет 3:10-22. Єв. Мк 12:13-17. за п'ятницю: Ап. 2 Пет 1:1-10. Єв. Мк 12:18-27."
```

## Використання

### У компоненті React

```typescript
import { formatReadingsForDisplay } from '@/utils/calendarGenerator_test';

function CalendarDayComponent({ day }: { day: CalendarDay }) {
  // Використання нового формату
  const formattedReadings = day.readingsStructured 
    ? formatReadingsForDisplay(day.readingsStructured)
    : day.readings; // Fallback на старий формат

  return (
    <div>
      <h3>{day.title}</h3>
      <p>{formattedReadings}</p>
    </div>
  );
}
```

### Прямий доступ до структури

```typescript
day.readingsStructured?.liturgy.forEach(reading => {
  console.log(`${reading.label}: ${reading.apostle} | ${reading.gospel}`);
});
// "Ряд.: 1 Пет 3:10-22 | Мк 12:13-17"
// "за п'ятницю: 2 Пет 1:1-10 | Мк 12:18-27"
```

## Особливості обробки

### 1. Передсвята Богоявлення (2-5 січня)

Для складних записів з fixed_readings.json (які містять "Передсв.:" або "Безсрібн.:"):
- Читання додається **як є**, без додавання мітки
- Користувач сам структурував текст у JSON

```json
{
  "apostle": "Передсв.: Євр. 326 зач.; 10:35 – 11:7 (за чт); Свт.: Євр. 318 зач.",
  "gospel": "Передсв.: Мк. 39 зач.; 9:10-16 (за чт); Свт.: Ін. 8 зач."
}
```

### 2. Прості святі

Для простих записів:
- Автоматично додається мітка на основі назви святого
- Форматування стандартне

### 3. Перенесені читання

Автоматично визначаються за правилами:
- Якщо **наступний день** - велике свято (з fixed_readings.json)
- І **сьогодні четвер** → додаються читання п'ятниці
- Мітка: "за п'ятницю"

## Переваги нового формату

1. ✅ **Структурованість** - легко фільтрувати і відображати окремі типи читань
2. ✅ **Відповідність** - формат ідентичний до офіційного додатку ПЦУ
3. ✅ **Розширюваність** - можна додати morning, evening readings
4. ✅ **Зворотна сумісність** - старе поле `readings` залишається
5. ✅ **Автоматизація** - мітки генеруються автоматично

## Майбутні покращення

- [ ] Додати ранкові читання (morning)
- [ ] Розділення на літургію Василія Великого / Іоана Золотоустого
- [ ] Римські цифри для глав (IV замість 4)
- [ ] Форматування з крапками ("Мк., 57 зач.")

---

**Статус**: ✅ Реалізовано
**Дата**: 29 січня 2026
